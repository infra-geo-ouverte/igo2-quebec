<mat-sidenav-container>
  <!-- todo enlever ceci -->
  <mat-sidenav-content position="end">
    <app-panels-handler [searchBar]="searchBar"></app-panels-handler>
    @if (!mobile) {
      <div id="searchDesktop">
        @if (showSearchBar) {
          <ng-container *ngTemplateOutlet="searchBar"></ng-container>
        }
        @if (mobile) {
          <div id="scaleLine"></div>
        }
      </div>
    }

    <igo-map-browser
      igoMapOffline
      igoMapContext
      igoLayerContext
      igoDropGeoFile
      igoHoverFeature
      [igoHoverFeatureEnabled]="true"
      igoQuery
      [queryFeatures]="true"
      (query)="onMapQuery($event)"
      [igoHoverFeatureDelay]="10"
      [map]="map"
      [ngClass]="{
        'igo-attribution-offset': map.getBaseLayers().length > 1,
        'map-hasfooter': hasFooter
      }"
    >
      @if (mobile) {
        <div id="scaleLine"></div>
      }
      <div
        class="map-actions --vertical --bottom --left"
        [@controlsOffsetY]="getControlsOffsetY()"
      >
        <igo-baselayers-switcher
          [map]="map"
          [useStaticIcon]="appConfig.useStaticIcon"
        >
        </igo-baselayers-switcher>
      </div>

      <div
        class="map-actions --vertical --bottom --right"
        [@controlsOffsetY]="getControlsOffsetY()"
      >
        @if (hasGeolocateButton) {
          <igo-geolocate-button
            [map]="map"
            color="primary"
          ></igo-geolocate-button>
        }
        <igo-zoom-button [map]="map" color="primary"></igo-zoom-button>
        <igo-rotation-button
          [showIfNoRotation]="appConfig.showRotationButtonIfNoRotation"
          [map]="map"
          color="primary"
        ></igo-rotation-button>
        @if (
          (panelsHandlerState.map.layers$ | async | filterableDataSource: 'ogc')
            .length > 0
        ) {
          <app-filter-button
            (filterToggled)="togglePanelComponent(shownComponents.Filter)"
            [tooltipDisabled]="mobile"
            color="primary"
          ></app-filter-button>
        }
        @if (appConfig.hasLegendButton) {
          <app-legend-button
            (legendToggled)="togglePanelComponent(shownComponents.Legend)"
            [legendInPanel]="appConfig.legendInPanel"
            [tooltipDisabled]="mobile"
            color="primary"
          ></app-legend-button>
        }
      </div>
    </igo-map-browser>

    @if (hasFooter && !mobile) {
      <app-footer></app-footer>
    }

    <app-map-overlay
      [@controlStateX]="
        (mediaService.media$ | async) !== 'mobile' &&
        (panelsHandlerState.opened$ | async)
          ? 'right'
          : 'left'
      "
    >
    </app-map-overlay>
  </mat-sidenav-content>
</mat-sidenav-container>

<ng-template #searchBar>
  <igo-search-bar
    (click)="$event.stopPropagation()"
    appearance="outline"
    searchIcon="magnify"
    [matTooltip]="'searchBar' | translate"
    matTooltipShowDelay="500"
    tooltip-position="after"
    [searchSettings]="false"
    color="primary"
    [forceNA]="appConfig.app?.forceCoordsNA"
    [term]="searchState.searchTerm$ | async"
    [store]="searchState.store"
    (searchTermChange)="onSearchTermChange($event)"
    (search)="onSearch($event)"
    (clearFeature)="clearSearch()"
  >
  </igo-search-bar>
</ng-template>
